(function(f,a){var i=String.fromCharCode,h=true,c=false;function b(k,l){return l?i(k&255)+b(k>>8,l-1):""}function g(k,l){return l?g(k>>8,l-1)+i(255-k&255):""}function j(k,l,m){return m?g(k,l):b(k,l)}function e(r,q){var k=r.length,p=k-1,s=0,o=a.pow,m;if(q){for(m=0;m<k;m++){s+=(255-r.charCodeAt(m))*o(256,p-m)}}else{for(m=0;m<k;m++){s+=r.charCodeAt(m)*o(256,m)}}return s}function d(n,k,m,v){var r=a.pow,q=a.floor,s=d.convertFromBinary,x=d.convertToBinary,t=n/8,l=r(2,n),u=l/2,w=u-1,o=1/u,p=1/w;return v?m?k?function(y,z){y=q(y<0?y*u+l:y*w);return x(y,t,z)}:function(y,z){return x(q(y*w),t,z)}:k?function(y,z){return x(y<0?y+l:y,t,z)}:function(y,z){return x(y,t,z)}:m?k?function(A,z){var y=s(A,z);return y>w?(y-l)*o:y*p}:function(z,y){return s(z,y)*p}:k?function(A,z){var y=s(A,z);return y>w?y-l:y}:function(z,y){return s(z,y)}}d.convertToBinary=j;d.convertFromBinary=e;d.fromFloat32=d(32,h,h,h);d.toFloat32=d(32,h,h,c);d.fromFloat24=d(24,h,h,h);d.toFloat24=d(24,h,h,c);d.fromFloat16=d(16,h,h,h);d.toFloat16=d(16,h,h,c);d.fromFloat8=d(8,h,h,h);d.toFloat8=d(8,h,h,c);d.fromInt32=d(32,h,c,h);d.toInt32=d(32,h,c,c);d.fromInt16=d(16,h,c,h);d.toInt16=d(16,h,c,c);d.fromInt8=d(8,h,c,h);d.toInt8=d(8,h,c,c);d.fromUint32=d(32,c,c,h);d.toUint32=d(32,c,c,c);d.fromUint16=d(16,c,c,h);d.toUint16=d(16,c,c,c);d.fromUint8=d(8,c,c,h);d.toUint8=d(8,c,c,c);f.Binary=d}(this,Math));(function(a,f){function g(h){this.data=h}var e=g.prototype={read:function(h){var i=this,j=i.data.substr(0,h);i.skip(h);return j},skip:function(h){var i=this,j=i.data=i.data.substr(h);i.pointer+=h;return j.length},readBuffer:function(p,n,o){var k=this,j="read"+o+n,q=n/8,h=p.length,m=0;while(k.data&&m<h){p[m++]=k[j]()}return m}},d,c;function b(k,i,j){var h=i/8;e["read"+k+i]=function(l){return j(this.read(h),l)}}for(d in f){c=/to([a-z]+)([0-9]+)/i.exec(d);c&&b(c[1],c[2],f[d])}a.Stream=g;g.newType=b}(this,this.Binary));this.PCMData=(function(a,c){function b(d){return(typeof d==="string"?b.decode:b.encode)(d)}b.decodeFrame=function(f,d,e){(new c(f)).readBuffer(e,d,"Float");return e};b.encodeFrame=function(j,f){var h=a["fromFloat"+f],d=j.length,g="",e;for(e=0;e<d;e++){g+=h(j[e])}return g};b.decode=function(D,C){var o=new c(D),k=o.read(4),v=o.readUint32();o=new c(o.read(v));var q=o.read(4),l=o.read(4),t=o.readUint32(),e=new c(o.read(t)),m=e.readUint16(),A=e.readUint16(),B=e.readUint32(),n=e.readUint32(),w=e.readUint16(),z=w/A,r=t===16?e.readUint16():e.readUint32(),g,j,s,x,u,p,y,d={},h={channelCount:A,bytesPerSample:w/A,sampleRate:n/w,chunks:d,data:u};function f(){g=o.read(4);j=o.readUint32();x=o.read(j);p=d[g]=d[g]||[];if(g==="data"){s=~~(j/z);u=h.data=new (typeof Float32Array!=="undefined"?Float32Array:Array)(s);b.decodeFrame(x,z*8,u)}else{p.push(x)}C&&(o.data?setTimeout(f,1):C(h))}if(C){o.data?f():C(h)}else{while(o.data){f()}}return h};b.encode=function(w,u){var s=a.fromUint32,x=a.fromUint16,m=w.data,e=w.sampleRate,f=w.channelCount||1,r=w.bytesPerSample||1,k=r*8,h=f*r,p=e*h,j=m.length,g=j*r,y=Math.pow(2,k-1)-1,d=[],l="",v,t,o,q;d.push("fmt "+s(16)+x(1)+x(f)+s(e)+s(p)+x(h)+x(k));d.push("data"+s(g)+b.encodeFrame(m,k));q=w.chunks;if(q){for(t in q){if(q.hasOwnProperty(t)){v=q[t];for(o=0;o<v.length;o++){l=v[o];d.push(t+s(l.length)+l)}}}}d=d.join("");d="RIFF"+s(d.length)+"WAVE"+d;u&&setTimeout(function(){u(d)},1);return d};return b}(Binary,Stream));